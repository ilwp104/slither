<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Slither.io - Local</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a2e;overflow:hidden;font-family:'Segoe UI',Arial,sans-serif;cursor:none}
canvas#c{display:block}
#ui{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:10}

/* Start */
#start{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:radial-gradient(ellipse at center,#1a1a4e 0%,#0a0a2e 70%);z-index:100}
#start h1{font-size:72px;color:#fff;text-shadow:0 0 20px #7c4dff,0 0 40px #7c4dff,0 0 80px #7c4dff;margin-bottom:8px;letter-spacing:6px}
.sub{color:#aaa;font-size:15px;margin-bottom:40px}
#nm{padding:12px 24px;font-size:20px;border:2px solid #7c4dff;border-radius:25px;background:rgba(255,255,255,.1);color:#fff;text-align:center;outline:none;width:280px;margin-bottom:20px}
#nm::placeholder{color:rgba(255,255,255,.4)}
#nm:focus{border-color:#b388ff;box-shadow:0 0 15px rgba(124,77,255,.5)}
#go{padding:14px 60px;font-size:22px;font-weight:bold;background:linear-gradient(135deg,#7c4dff,#b388ff);color:#fff;border:none;border-radius:30px;cursor:pointer;transition:.3s;letter-spacing:2px}
#go:hover{transform:scale(1.05);box-shadow:0 0 25px rgba(124,77,255,.6)}
.info{margin-top:30px;color:#777;font-size:13px;text-align:center;line-height:2}

/* HUD */
#sc{position:absolute;top:20px;left:50%;transform:translateX(-50%);color:#fff;font-size:22px;font-weight:bold;text-shadow:0 2px 8px rgba(0,0,0,.9)}
#lb{position:absolute;top:20px;right:20px;background:rgba(0,0,0,.55);padding:12px 16px;border-radius:10px;color:#fff;min-width:180px;backdrop-filter:blur(4px)}
#lb h3{text-align:center;margin-bottom:8px;font-size:13px;color:#b388ff;letter-spacing:1px}
.le{display:flex;justify-content:space-between;padding:2px 0;font-size:12px;color:#ccc}
.le.me{color:#7c4dff;font-weight:bold}
#mm{position:absolute;bottom:20px;right:20px}

/* Game Over */
#ov{position:fixed;top:0;left:0;width:100%;height:100%;display:none;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,.7);z-index:50;backdrop-filter:blur(3px)}
#ov h2{color:#ff6b6b;font-size:48px;margin-bottom:10px}
.fs{color:#fff;font-size:22px;margin-bottom:30px}
#rt{padding:12px 50px;font-size:20px;font-weight:bold;background:linear-gradient(135deg,#ff6b6b,#ee5a24);color:#fff;border:none;border-radius:25px;cursor:pointer;transition:.3s}
#rt:hover{transform:scale(1.05);box-shadow:0 0 20px rgba(255,107,107,.5)}

/* Ads */
.ad{background:rgba(255,255,255,.05);border:1px dashed rgba(255,255,255,.15);border-radius:8px;display:flex;align-items:center;justify-content:center;color:rgba(255,255,255,.2);font-size:11px;overflow:hidden}
#ad1{width:728px;max-width:90vw;height:90px;margin-top:30px}
#ad2{position:absolute;bottom:20px;left:20px;width:320px;height:50px;pointer-events:auto}
#ad3{width:336px;height:280px;margin-bottom:24px}
</style>
</head>
<body>
<canvas id="c"></canvas>

<div id="start">
    <h1>SLITHER</h1>
    <div class="sub">Grow. Survive. Dominate.</div>
    <input type="text" id="nm" placeholder="Enter your name" maxlength="15">
    <button id="go">PLAY</button>
    <div class="info">Mouse — Move direction<br>Left Click / Space — Boost</div>
    <div id="ad1" class="ad">AD 728x90</div>
</div>

<div id="ui" style="display:none">
    <div id="sc">Score: 0</div>
    <div id="lb"><h3>LEADERBOARD</h3><div id="ll"></div></div>
    <canvas id="mm" width="160" height="160"></canvas>
    <div id="ad2" class="ad">AD 320x50</div>
</div>

<div id="ov">
    <h2>GAME OVER</h2>
    <div class="fs" id="fsc"></div>
    <div id="ad3" class="ad">AD 336x280</div>
    <button id="rt">PLAY AGAIN</button>
</div>

<script>
// ============================================================
//  Slither.io — Local Single-File Version
// ============================================================
const W = 6000, GRID = 80, INIT_LEN = 20, GAP = 4, BSPD = 3.2, BSTSPD = 6;
const FOOD_N = 800, AI_N = 15, FOOD_R = 5, MIN_BR = 6, TR = 0.12, CELL = 200;
const GCOLS = Math.ceil(W / CELL);

const PAL = [
    ['#ff6b6b','#ee5a24'],['#48dbfb','#0abde3'],['#feca57','#ff9f43'],
    ['#55efc4','#00b894'],['#a29bfe','#6c5ce7'],['#fd79a8','#e84393'],
    ['#fdcb6e','#f39c12'],['#00cec9','#00b894'],['#e17055','#d63031'],
    ['#74b9ff','#0984e3'],['#dfe6e9','#b2bec3'],['#fab1a0','#e17055'],
];
const FCOL = ['#ff6b6b','#48dbfb','#feca57','#55efc4','#a29bfe','#fd79a8','#fdcb6e','#00cec9','#ff9ff3','#f368e0'];
const NAMES = ['Viper','Cobra','Python','Mamba','Naga','Serpent','Basilisk','Hydra','Rattler','Boa','Adder','Asp','Draco','Slyther','Fang','Scales','Striker','Shadow','Venom','Blaze'];

const cv = document.getElementById('c'), cx = cv.getContext('2d');
const mc = document.getElementById('mm'), mx = mc.getContext('2d');

let snakes = [], foods = [], grid = [], player = null;
let cam = {x:3000,y:3000,z:1}, mouse = {x:0,y:0}, boost = false, running = false;

// --- Spatial Grid ---
function resetGrid(){ grid = new Array(GCOLS*GCOLS); for(let i=0;i<grid.length;i++) grid[i]=[]; }
function gk(x,y){ return Math.min(GCOLS-1,Math.max(0,x/CELL|0)) + Math.min(GCOLS-1,Math.max(0,y/CELL|0))*GCOLS; }
function nearCells(x,y,r){
    const c1=Math.max(0,(x-r)/CELL|0),c2=Math.min(GCOLS-1,(x+r)/CELL|0);
    const r1=Math.max(0,(y-r)/CELL|0),r2=Math.min(GCOLS-1,(y+r)/CELL|0);
    const out=[];
    for(let r0=r1;r0<=r2;r0++) for(let c=c1;c<=c2;c++) out.push(r0*GCOLS+c);
    return out;
}

// --- Snake ---
class Snake {
    constructor(name, isP){
        this.name=name; this.isP=isP; this.alive=true;
        this.ang=Math.random()*Math.PI*2; this.tAng=this.ang;
        this.spd=BSPD; this.boost=false;
        this.pi=Math.random()*PAL.length|0;
        const cx=W/2+(Math.random()-.5)*2000, cy=W/2+(Math.random()-.5)*2000;
        this.seg=[];
        for(let i=0;i<INIT_LEN;i++) this.seg.push({x:cx-i*GAP*Math.cos(this.ang),y:cy-i*GAP*Math.sin(this.ang)});
        this.aiT=0; this.aiW=this.ang;
    }
    get x(){return this.seg[0].x} get y(){return this.seg[0].y}
    get len(){return this.seg.length} get sc(){return Math.max(0,this.seg.length-INIT_LEN)}
    get br(){return Math.min(MIN_BR+this.len*.08,22)} get hr(){return this.br*1.15}

    update(){
        if(!this.alive) return;
        let d=this.tAng-this.ang;
        while(d>Math.PI)d-=Math.PI*2; while(d<-Math.PI)d+=Math.PI*2;
        this.ang+=d*TR;
        const b=this.isP?boost:this.boost;
        this.spd=(b&&this.len>20)?BSTSPD:BSPD;
        const h={x:this.seg[0].x+Math.cos(this.ang)*this.spd, y:this.seg[0].y+Math.sin(this.ang)*this.spd};
        const m=150;
        if(h.x<m)h.x+=(m-h.x)*.1; if(h.y<m)h.y+=(m-h.y)*.1;
        if(h.x>W-m)h.x-=(h.x-(W-m))*.1; if(h.y>W-m)h.y-=(h.y-(W-m))*.1;
        h.x=Math.max(10,Math.min(W-10,h.x)); h.y=Math.max(10,Math.min(W-10,h.y));
        this.seg.unshift(h);
        if(b&&this.len>20){const t=this.seg.pop();this.seg.pop();if(Math.random()<.3)addFood(t.x,t.y);}
        else this.seg.pop();
    }
    grow(n){for(let i=0;i<n;i++){const t=this.seg[this.seg.length-1];this.seg.push({x:t.x,y:t.y});}}
    die(){
        if(!this.alive)return; this.alive=false;
        for(let i=0;i<this.seg.length;i+=3){const s=this.seg[i];addFood(s.x+(Math.random()-.5)*10,s.y+(Math.random()-.5)*10,true);}
    }
    ai(){
        if(!this.alive||this.isP)return;
        this.aiT--;
        const bm=400,cx2=W/2,cy2=W/2;
        if(this.x<bm||this.x>W-bm||this.y<bm||this.y>W-bm){this.tAng=Math.atan2(cy2-this.y,cx2-this.x);this.aiT=60;this.boost=false;return;}
        for(const o of snakes){
            if(o===this||!o.alive)continue;
            const dx=this.x-o.x,dy=this.y-o.y;
            if(dx*dx+dy*dy<14400&&o.len>this.len*.8){this.tAng=Math.atan2(dy,dx)+(Math.random()-.5)*.5;this.boost=this.len>25;this.aiT=30;return;}
        }
        if(this.aiT<=0){
            this.boost=false;
            let best=null,bd=90000;const minD=400;
            for(const f of foods){const dx=this.x-f.x,dy=this.y-f.y,d2=dx*dx+dy*dy;if(d2>minD&&d2<bd){bd=d2;best=f;}}
            if(best){this.tAng=Math.atan2(best.y-this.y,best.x-this.x)+(Math.random()-.5)*.3;this.aiT=15+Math.random()*10;}
            else{this.aiW+=(Math.random()-.5)*2;this.tAng=this.aiW;this.aiT=40+Math.random()*60;}
        }
    }
}

function addFood(x,y,big){
    foods.push({x:x??Math.random()*(W-200)+100, y:y??Math.random()*(W-200)+100,
        c:FCOL[Math.random()*FCOL.length|0], r:big?FOOD_R*1.8:FOOD_R, v:big?3:1});
}

// --- Init ---
function resize(){cv.width=innerWidth;cv.height=innerHeight;}
window.addEventListener('resize',resize); resize();
cv.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});
window.addEventListener('mousedown',()=>{boost=true});
window.addEventListener('mouseup',()=>{boost=false});
window.addEventListener('keydown',e=>{if(e.code==='Space'){boost=true;e.preventDefault();}});
window.addEventListener('keyup',e=>{if(e.code==='Space')boost=false;});
document.getElementById('go').addEventListener('click',startGame);
document.getElementById('rt').addEventListener('click',startGame);
document.getElementById('nm').addEventListener('keydown',e=>{if(e.key==='Enter')startGame();});
document.getElementById('nm').focus();

function startGame(){
    const name=document.getElementById('nm').value.trim()||'Player';
    snakes=[]; foods=[]; boost=false; running=true;
    for(let i=0;i<FOOD_N;i++) addFood();
    player=new Snake(name,true); snakes.push(player);
    for(let i=0;i<AI_N;i++) spawnAI();
    document.getElementById('start').style.display='none';
    document.getElementById('ov').style.display='none';
    document.getElementById('ui').style.display='block';
    document.body.style.cursor='none';
}

function spawnAI(near){
    const s=new Snake(NAMES[Math.random()*NAMES.length|0],false);
    // Spawn near player so there's always action nearby
    if(near && player && player.alive){
        const ang=Math.random()*Math.PI*2, d=800+Math.random()*1200;
        const nx=Math.max(200,Math.min(W-200,player.x+Math.cos(ang)*d));
        const ny=Math.max(200,Math.min(W-200,player.y+Math.sin(ang)*d));
        for(let i=0;i<s.seg.length;i++){s.seg[i].x=nx-i*GAP*Math.cos(s.ang);s.seg[i].y=ny-i*GAP*Math.sin(s.ang);}
    }
    s.grow(Math.random()*60|0); snakes.push(s);
}

// --- Game Loop ---
function tick(){
    if(!running)return;
    // Player angle
    if(player&&player.alive) player.tAng=Math.atan2(mouse.y-cv.height/2,mouse.x-cv.width/2);
    for(const s of snakes){s.ai();s.update();}

    // Spatial grid
    resetGrid();
    for(const s of snakes){if(!s.alive)continue;for(let i=8;i<s.seg.length;i+=2){const sg=s.seg[i];grid[gk(sg.x,sg.y)].push({s,i,x:sg.x,y:sg.y});}}

    // Food
    for(const s of snakes){
        if(!s.alive)continue;const hr2=(s.hr+FOOD_R*2)*(s.hr+FOOD_R*2);
        for(let i=foods.length-1;i>=0;i--){const f=foods[i],dx=s.x-f.x,dy=s.y-f.y;if(dx*dx+dy*dy<hr2){s.grow(f.v);foods.splice(i,1);}}
    }

    // Snake collision
    for(const s of snakes){
        if(!s.alive)continue;
        const hr=s.hr+15,hr2=hr*hr;
        const cells=nearCells(s.x,s.y,hr);
        for(const ck of cells){const cell=grid[ck];for(let j=0;j<cell.length;j++){const e=cell[j];if(e.s===s)continue;const dx=s.x-e.x,dy=s.y-e.y;if(dx*dx+dy*dy<hr2){s.die();break;}}if(!s.alive)break;}
    }

    // Player dead
    if(player&&!player.alive){
        running=false;
        document.getElementById('fsc').textContent=`Score: ${player.sc}  |  Length: ${player.len}`;
        setTimeout(()=>{document.getElementById('ov').style.display='flex';document.body.style.cursor='default';},600);
    }

    // Cleanup & respawn
    snakes=snakes.filter(s=>s.alive||s.isP);
    let ac=0;for(const s of snakes)if(!s.isP&&s.alive)ac++;
    while(ac<AI_N){spawnAI(true);ac++;}
    while(foods.length<FOOD_N)addFood();

    // Camera
    if(player){cam.x+=(player.x-cam.x)*.15;cam.y+=(player.y-cam.y)*.15;const tz=Math.max(.45,1-player.len*.0008);cam.z+=(tz-cam.z)*.03;}

    // HUD
    if(player) document.getElementById('sc').textContent=`Score: ${player.sc}  |  Length: ${player.len}`;
    const sorted=snakes.filter(s=>s.alive).sort((a,b)=>b.sc-a.sc).slice(0,10);
    let h='';sorted.forEach((s,i)=>{h+=`<div class="le${s.isP?' me':''}""><span>${i+1}. ${s.name}</span><span>${s.sc}</span></div>`;});
    document.getElementById('ll').innerHTML=h;
}

// --- Render ---
function render(){
    const w=cv.width,h=cv.height;
    cx.clearRect(0,0,w,h);
    cx.save();
    cx.translate(w/2,h/2);cx.scale(cam.z,cam.z);cx.translate(-cam.x,-cam.y);

    // BG
    const hw=w/cam.z/2+GRID,hh=h/cam.z/2+GRID;
    const sx=Math.floor((cam.x-hw)/GRID)*GRID,sy=Math.floor((cam.y-hh)/GRID)*GRID;
    const ex=cam.x+hw,ey=cam.y+hh;
    cx.fillStyle='#0a0a2e';
    cx.fillRect(Math.max(0,sx),Math.max(0,sy),Math.min(W,ex)-Math.max(0,sx),Math.min(W,ey)-Math.max(0,sy));
    cx.strokeStyle='rgba(60,60,120,.25)';cx.lineWidth=1;cx.beginPath();
    for(let x=sx;x<=ex;x+=GRID){if(x<0||x>W)continue;cx.moveTo(x,Math.max(0,sy));cx.lineTo(x,Math.min(W,ey));}
    for(let y=sy;y<=ey;y+=GRID){if(y<0||y>W)continue;cx.moveTo(Math.max(0,sx),y);cx.lineTo(Math.min(W,ex),y);}
    cx.stroke();

    // Boundary
    cx.strokeStyle='#ff4757';cx.lineWidth=6;cx.strokeRect(0,0,W,W);
    cx.strokeStyle='rgba(255,71,87,.3)';cx.lineWidth=18;cx.strokeRect(0,0,W,W);

    // Food — batched by color
    const byC={};
    for(let i=0;i<foods.length;i++){const f=foods[i];if(Math.abs(f.x-cam.x)>hw||Math.abs(f.y-cam.y)>hh)continue;(byC[f.c]||(byC[f.c]=[])).push(f);}
    for(const c in byC){
        const a=byC[c];
        cx.fillStyle=c+'44';cx.beginPath();for(let i=0;i<a.length;i++){const f=a[i];cx.moveTo(f.x+f.r*1.6,f.y);cx.arc(f.x,f.y,f.r*1.6,0,Math.PI*2);}cx.fill();
        cx.fillStyle=c;cx.beginPath();for(let i=0;i<a.length;i++){const f=a[i];cx.moveTo(f.x+f.r,f.y);cx.arc(f.x,f.y,f.r,0,Math.PI*2);}cx.fill();
        cx.fillStyle='rgba(255,255,255,.35)';cx.beginPath();for(let i=0;i<a.length;i++){const f=a[i];const r=f.r*.3;cx.moveTo(f.x-f.r*.2+r,f.y-f.r*.2);cx.arc(f.x-f.r*.2,f.y-f.r*.2,r,0,Math.PI*2);}cx.fill();
    }

    // Snakes
    const sorted=snakes.filter(s=>s.alive).sort((a,b)=>a.isP?1:b.isP?-1:0);
    for(const s of sorted) drawSnake(s);

    cx.restore();

    // Cursor
    if(running){
        const mx2=mouse.x,my2=mouse.y;
        cx.strokeStyle='rgba(255,255,255,.4)';cx.lineWidth=1.5;
        cx.beginPath();cx.arc(mx2,my2,12,0,Math.PI*2);cx.stroke();
        cx.beginPath();cx.moveTo(mx2-18,my2);cx.lineTo(mx2-7,my2);cx.moveTo(mx2+7,my2);cx.lineTo(mx2+18,my2);
        cx.moveTo(mx2,my2-18);cx.lineTo(mx2,my2-7);cx.moveTo(mx2,my2+7);cx.lineTo(mx2,my2+18);cx.stroke();
    }

    // Minimap
    const mw=mc.width,mh=mc.height;mx.clearRect(0,0,mw,mh);
    mx.fillStyle='rgba(0,0,0,.6)';mx.beginPath();mx.roundRect(0,0,mw,mh,8);mx.fill();
    mx.strokeStyle='rgba(124,77,255,.4)';mx.lineWidth=1;mx.beginPath();mx.roundRect(0,0,mw,mh,8);mx.stroke();
    const ms=(mw-10)/W,mp=5;
    for(const s of snakes){if(!s.alive)continue;mx.fillStyle=s.isP?'#7c4dff':PAL[s.pi][0];mx.beginPath();mx.arc(s.x*ms+mp,s.y*ms+mp,s.isP?4:2,0,Math.PI*2);mx.fill();}
    const vw=w/cam.z*ms,vh=h/cam.z*ms;
    mx.strokeStyle='rgba(255,255,255,.3)';mx.lineWidth=1;mx.strokeRect(cam.x*ms+mp-vw/2,cam.y*ms+mp-vh/2,vw,vh);
}

function drawSnake(s){
    const seg=s.seg,n=seg.length;if(n<2)return;
    const br=s.br,hr=s.hr,p=PAL[s.pi];

    // Glow
    cx.fillStyle=p[0]+'33';cx.beginPath();
    for(let i=n-1;i>=1;i--){const sg=seg[i],t=i/n,r=br*(.4+t*.6)+4;cx.moveTo(sg.x+r,sg.y);cx.arc(sg.x,sg.y,r,0,Math.PI*2);}
    cx.fill();

    // Body — 2 color passes
    for(let ci=0;ci<2;ci++){
        cx.fillStyle=p[ci];cx.beginPath();
        for(let i=n-1;i>=1;i--){if((Math.floor(i/3)%2)!==ci)continue;const sg=seg[i],t=i/n,r=br*(.4+t*.6);cx.moveTo(sg.x+r,sg.y);cx.arc(sg.x,sg.y,r,0,Math.PI*2);}
        cx.fill();
    }

    // Head
    const hd=seg[0],nx=seg[1],ha=Math.atan2(hd.y-nx.y,hd.x-nx.x);
    cx.fillStyle=p[0]+'44';cx.beginPath();cx.arc(hd.x,hd.y,hr+5,0,Math.PI*2);cx.fill();
    cx.fillStyle=p[0];cx.beginPath();cx.arc(hd.x,hd.y,hr,0,Math.PI*2);cx.fill();

    // Eyes
    const eo=hr*.45,er=hr*.35,pr=hr*.18,pp=ha+Math.PI/2;
    cx.fillStyle='#fff';cx.beginPath();
    for(let si=-1;si<=1;si+=2){const ex2=hd.x+Math.cos(ha)*hr*.3+Math.cos(pp)*eo*si,ey2=hd.y+Math.sin(ha)*hr*.3+Math.sin(pp)*eo*si;cx.moveTo(ex2+er,ey2);cx.arc(ex2,ey2,er,0,Math.PI*2);}
    cx.fill();
    cx.fillStyle='#111';cx.beginPath();
    for(let si=-1;si<=1;si+=2){const ex2=hd.x+Math.cos(ha)*hr*.3+Math.cos(pp)*eo*si,ey2=hd.y+Math.sin(ha)*hr*.3+Math.sin(pp)*eo*si;const px2=ex2+Math.cos(ha)*pr*.4,py2=ey2+Math.sin(ha)*pr*.4;cx.moveTo(px2+pr,py2);cx.arc(px2,py2,pr,0,Math.PI*2);}
    cx.fill();

    // Name
    if(s.isP||s.len>25){cx.fillStyle='rgba(255,255,255,.85)';cx.font=`bold ${Math.max(12,hr*1.1)|0}px 'Segoe UI',Arial`;cx.textAlign='center';cx.fillText(s.name,hd.x,hd.y-hr-8);}
}

// --- Main Loop ---
function loop(){tick();render();requestAnimationFrame(loop);}
loop();
</script>
</body>
</html>
